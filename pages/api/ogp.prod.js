"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var path=_interopRequireWildcard(require("path"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&((r=a?Object.getOwnPropertyDescriptor(e,o):null)&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=e[o])}return n.default=e,t&&t.set(e,n),n}var _require=require("canvas"),createCanvas=_require.createCanvas,registerFont=_require.registerFont,loadImage=_require.loadImage,_callee=function(t,r){var n,p,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(t){var r,n,a,o,u,i,c,s,l,f;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1600,n=900,a=72,o=16,u=68,registerFont(path.join("fonts","shirokuma-regular.ttf"),{family:"shirokuma-regular"}),i=createCanvas(r,n),c=i.getContext("2d"),e.next=10,regeneratorRuntime.awrap(loadImage(path.join("images","ogp-background.jpg")));case 10:return s=e.sent,c.drawImage(s,0,0,r,n),c.font="".concat(a," shirokuma-regular"),c.fillStyle="#000",l=p(t,r-u,c),f=n/2-(a+o)/2*(l.length-1),l.forEach(function(e){var t=c.measureText(e).width;c.fillText(e,(r-t)/2,f),f+=a+o}),e.abrupt("return",i.toBuffer());case 18:case"end":return e.stop()}})},p=function(e,t,r){var n=[],a="";return e.split("").forEach(function(e){a+=e,r.measureText(a).width>t&&(n.push(a.slice(0,-1)),a=a.slice(-1))}),n.push(a),n},n=t.query.text,e.prev=3,e.next=6,regeneratorRuntime.awrap(a("webstock.dev/"+n));case 6:o=e.sent,r.writeHead(200,{"Content-Type":"image/png","Content-Length":o.length}),r.end(o,"binary"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.log(e.t0),r.end(e.t0.message);case 15:case"end":return e.stop()}},null,null,[[3,11]])};exports.default=_callee;